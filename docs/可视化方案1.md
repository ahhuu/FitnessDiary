# App UI 深度优化与智能分析逻辑升级

**指令背景：**
用户对“个人主页”的视觉间距、数据报表的 UI 美观度，以及“智能分析”的触发逻辑提出了明确的优化需求。我们需要从单纯的“展示数据”升级为“交互式分析”。

**核心目标：**
1.  **UI 修复：** 统一个人主页各卡片组件的垂直间距，消除视觉割裂感。
2.  **报表重构：** 废弃原有的简陋图表，采用**“卡片式 + 仪表盘”**风格重写 BottomSheet，使其与“成就勋章墙”风格保持高度一致。
3.  **交互升级（核心）：**
    * **默认状态：** 打开报表时，如果今日已有历史分析记录，直接展示该记录；如果无记录，则展示“开始分析”按钮。
    * **点击触发：** 点击按钮后，根据当前数据生成分析文案，并保存到本地（持久化），刷新界面展示结果。

---

### 📋 详细任务清单

#### 任务一：UI 间距统一 (`fragment_profile.xml`)
* **问题：** “数据周报”卡片与上方卡片的间距与其他模块不一致。
* **修正：** 检查 `ProfileFragment` 中所有顶级 `MaterialCardView` 的 `layout_marginTop`。
* **标准：** 找到新添加的“数据周报”卡片，调整其上边距，使其与上方“成就勋章墙”卡片的上边距保持相同数值。

#### 任务二：报表弹窗 UI 焕新 (`fragment_report_bottom_sheet.xml`)
彻底抛弃原有的直角图表风格，改为**圆角卡片组**。
* **布局结构：** 使用 `NestedScrollView` 包裹一个垂直的 `LinearLayout`。
* **模块设计：**
    1.  **周/月切换器：** 顶部居中 `MaterialButtonToggleGroup`。
    2.  **数据卡片组 (2x2 Grid 或 垂直排列)：**
        * **卡片 A (训练)：** 左侧显示图标+标题，右侧显示进度条（例如：本周打卡 3/5）。
        * **卡片 B (饮食)：** 显示热量仪表盘（使用 `ProgressBar` 圆环），对比摄入 vs 消耗。
        * **卡片 C (体重)：** 显示最近一次体重记录及 BMI 指数。
    * **样式要求：** 所有卡片必须有圆角 (`cardCornerRadius="16dp"`)，背景色为纯白（弹窗底色设为浅灰以形成对比），字体使用 `Google Sans` 或系统默认粗体。

#### 任务三：智能分析逻辑实现 (`ReportBottomSheetFragment.java`)
实现“按需分析”与“结果持久化”。

* **1. 布局新增：**
    * 在数据卡片下方，添加一个容器 `FrameLayout`。
    * **子 View 1 (按钮状态)：** 一个全宽的大按钮 "🔍 生成今日健康分析"。
    * **子 View 2 (结果状态)：** 一个带背景色的文本卡片 (`TextView`)，用于展示分析结果。
* **2. 持久化存储 (`SharedPreferences`)：**
    * Key 定义：`KEY_LAST_ANALYSIS_DATE` (记录日期), `KEY_LAST_ANALYSIS_TEXT` (记录文案)。
* **3. 业务逻辑 (`checkAnalysisState()`):**
    * **OnViewCreated:** 获取当前日期 (YYYY-MM-DD)。
    * **判断：** 读取本地存储的 `LAST_DATE`。
        * **IF (`LAST_DATE` == `TODAY`):** 说明今天已经分析过了 -> **隐藏按钮，直接显示存好的 `LAST_TEXT`**。
        * **ELSE:** 说明今天还没分析 -> **显示按钮，隐藏文本卡片**。
* **4. 点击事件：**
    * 用户点击按钮 -> 调用分析算法 -> 生成文案 -> **存入 SharedPreferences (更新 Date 和 Text)** -> 刷新 UI 显示结果。

---

### 💻 核心代码生成要求

请直接给出以下关键文件的代码：

#### 1. `fragment_profile.xml`
*(仅展示修正了 margin 属性的卡片容器代码)*

#### 2. `fragment_report_bottom_sheet.xml`
*(全新的 UI 布局代码，包含上方的数据卡片组，以及下方的“按钮/结果”切换容器)*

#### 3. `ReportBottomSheetFragment.java`
*(包含完整的 `checkAnalysisState` 逻辑、SharedPreference 读写逻辑、以及按钮点击后的生成逻辑)*

#### 4. `AnalysisUtils.java` (可选)
*(一个简单的工具类，用于根据传入的 boolean/int 数据返回 String 类型的建议文案，例如：)*
```java
public static String getAdvice(int workoutDays, float caloriesRatio) {
    if (workoutDays >= 4) return "本周训练非常刻苦！你的自律令人惊叹。建议适当增加碳水摄入...";
    // ... 其他逻辑
}
💡 开发者提示
关于图表： 为了美观，请尽量使用 Android 原生的 ProgressBar (水平或圆形) 来替代复杂的 MPAndroidChart，除非确实需要绘制复杂的体重曲线。原生控件更容易控制圆角和颜色风格。

关于颜色： 分析结果的背景建议使用 App 主题色的 10% 透明度版本 (e.g., #1A009688)，这样看起来更像是一个“提示框”。