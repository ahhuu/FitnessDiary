**App 3.0 核心重构：聚合视图、智能逻辑与动态游戏化 (终极合并版)**

**指令背景：**
当前 App 处于 2.0 阶段，UI 基础已完成。现在需要进行 **3.0 版本的大重构**。
本次任务需要**合并**“UI 交互升级”与“业务逻辑完善”两个维度的需求，从底层数据查询到顶层 UI 渲染进行全面升级。

**核心目标：**
1.  **视图聚合：** 训练计划和饮食记录不再平铺，升级为“分类折叠”和“分餐卡片”展示。
2.  **智能排期：** 每日打卡页必须严格只显示“今日任务”，拒绝冗余。
3.  **去重与概览：** 训练计划页顶部移除与打卡页重复的进度数据，改为“计划库概览”。
4.  **真实游戏化：** 个人中心的等级和成就必须基于**真实数据库统计**，而非静态数据。

---

### 📋 具体任务清单

#### 1. 训练计划页 (`FragmentPlan`) - 仓库管理员视角
* **顶部卡片重构 (Dashboard):**
    * **移除** 原有的“本周进度/打卡天数”显示（避免与首页重复）。
    * **新增 "计划库数据概览"：**
        * **左侧（不变）：** 大数字显示 **"活跃计划总数"**。
        * **右侧：** 显示 **"覆盖部位"** (例如：胸部、背部、腹部)。
        * *逻辑：* ViewModel 从数据库获取所有 Plan，统计数量，并提取 `category` 字段去重拼接。
* **列表重构 (Grouped List):**
    * **废弃** 平铺的 `PlanAdapter`。
    * **实现** `GroupedPlanAdapter` (使用 Nested RecyclerView 或 Multi-Type ViewType 实现)：
        * **父层级 (Category):** 显示分类名称 (如 "胸部训练")、该分类下的动作数量。点击可 **展开/折叠** 子列表。
        * **子层级 (Plan Item):** 显示具体动作详情。
        * **编辑功能：** 点击子项弹出 `Dialog`，允许修改组数、次数和分类名称。

#### 2. 每日打卡页 (`FragmentCheckIn`) - 执行者视角
* **智能过滤逻辑 (`CheckInViewModel`):**
    * 重写 `getTodayPlans()`。
    * **核心算法：** 获取今天是周几 (`Calendar.DAY_OF_WEEK`)，遍历所有计划，**仅保留** `scheduledDays` 包含今日的计划。
* **UI 聚合展示：**
    * 复用计划页的“分组逻辑”。如果今天既有“有氧”又有“力量”，应显示两个分类标题，标题下才是具体的 CheckBox 列表。
    * **默认状态：** 默认**全部展开**，方便用户操作。
* **空状态 (Rest Day):**
    * 如果今日筛选结果为空，显示“🎉 休息日”插画，并提供按钮“添加临时训练”。

#### 3. 饮食记录页 (`FragmentDiet`) - 分餐管理
* **数据源重构：**
    * ViewModel 不再直接返回 `List<FoodRecord>`。
    * 而是返回 `List<MealSection>`。`MealSection` 包含：餐点类型 (0-3)、该餐总热量、该餐下的 `List<FoodRecord>`。
* **UI 卡片化 (`DietAdapter`):**
    * 页面固定渲染 4 个父卡片：**[早餐]、[午餐]、[晚餐]、[加餐]**。
    * **父卡片头：** 显示餐点名称 + **动态计算的该餐总热量** (如 "午餐 · 850 千卡")。
    * **父卡片内容：** 包含该餐的食物列表。如果没有食物，显示“点击添加”的引导占位符。
    * **折叠逻辑：** 点击卡片头部可折叠/展开内容。

#### 4. 个人中心 (`FragmentProfile`) - 真实动态数据
**严禁使用静态 Mock 数据，所有数据必须来自数据库查询。**

* **A. 动态等级系统 (Dynamic Level):**
    * 在 `ProfileViewModel` 中统计 `DailyLog` 表中不重复的日期总数 (Total Training Days)。
    * **等级规则：**
        * 0-15 天: **Lv.1 见习铁友** 🐣
        * 16-30 天: **Lv.2 训练生** 🔨
        * 31-60 天: **Lv.3 健身达人** 💪
        * 60+ 天: **Lv.4 钢铁之躯** 🏆
    * **UI：** 将等级名称显示在头部用户名的右侧 (Badge 样式)。

* **B. 动态成就墙 (Achievements RecyclerView):**
    * **区域位置：** 在页面底部，"清除数据"按钮的上方。
    * **判定逻辑 (`checkAchievements`):**
        1.  **"初出茅庐"**: 总打卡天数 >= 1。
        2.  **"持之以恒"**: 连续打卡天数 (currentStreak) >= 3。
        3.  **"计划大师"**: 活跃计划总数 >= 3。
        4.  **"自律饮食"**: 今日摄入热量 > 0。
    * **UI 表现：**
        * 未解锁：灰色图标 + 灰色文字。
        * 已解锁：彩色图标 + 深色文字 + "已点亮"标记。

* **C. 底部填充:**
    * 成就墙下方添加 "⚙️ 通用设置" 条目 (点击 Toast 提示)。

#### 5. 数据库层支持 (DAO Updates)
请检查并更新 DAO 以支持上述查询：
* `PlanDao`: 需要查询所有计划 (用于概览)，需要按 ID 更新计划 (用于编辑)。
* `LogDao`: 需要统计总打卡天数 (count distinct dates)。
* `FoodRecordDao`: 需要按日期查询所有记录 (用于分餐聚合)。

---
